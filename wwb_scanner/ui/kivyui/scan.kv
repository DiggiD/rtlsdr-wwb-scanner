<ScanControls>:
    orientation: 'horizontal'
    start_btn: start_btn
    stop_btn: stop_btn
    panel_widget: panel_widget
    advanced_panel_item: advanced_panel_item
    live_view: live_view
    live_spectrum_graph: live_spectrum_graph
    canvas:
        Color:
            rgb: .8, .8, .8
        Line:
            rectangle: self.x+1, self.y+1,self.width-1, self.height-1
    TabbedPanel:
        id: panel_widget
        do_default_tab: False
        canvas:
            Color:
                rgb: .8, .8, .8
            Line:
                rectangle: self.x+1, self.y+1,self.width-1, self.height-1
        TabbedPanelItem:
            text: 'General'
            BoxLayout:
                orientation: 'horizontal'
                BoxLayout:
                    orientation: 'vertical'
                    Label:
                        text: 'Scan Range'
                    BoxLayout:
                        orientation: 'horizontal'
                        TextInput:
                            multiline: False
                            text: '%07.3f' % (root.scan_range[0])
                            on_focus: if not self.focus: root.scan_range[0] = float(self.text)
                        TextInput:
                            multiline: False
                            text: '%07.3f' % (root.scan_range[1])
                            on_focus: if not self.focus: root.scan_range[1] = float(self.text)
                BoxLayout:
                    orientation: 'vertical'
                    Label:
                        text: 'Gain'
                    Button:
                        text: str(root.gain)
                        on_release: root.gain_dropdown.open(self)
                NumericOption:
                    label_text: 'Freq Correction'
                    value: root.freq_correction
                    on_value: root.freq_correction = self.value
                NumericOption:
                    label_text: 'Sample Rate'
                    is_float: True
                    value: root.sample_rate / 1000.
                    on_value: root.sample_rate = self.value * 1000.
                NumericOption:
                    label_text: 'Overlap Ratio (MHz)'
                    is_float: True
                    value: root.sweep_overlap_ratio
                    on_value: root.sweep_overlap_ratio = self.value
                BoxLayout:
                    orientation: 'vertical'
                    BoxLayout:
                        orientation: 'horizontal'
                        CheckBox:
                            group: 'scanner_backend_cb'
                            active: root.scanner_backend == 'Builtin'
                            on_active: if self.active: root.scanner_backend = 'builtin'
                        Label:
                            text: 'Builtin'
                    BoxLayout:
                        orientation: 'horizontal'
                        CheckBox:
                            group: 'scanner_backend_cb'
                            active: root.scanner_backend == 'rtl_power'
                            on_active: if self.active: root.scanner_backend = 'rtl_power'
                        Label:
                            text: 'rtl_power'
        TabbedPanelItem:
            text: 'Advanced'
            id: advanced_panel_item

        TabbedPanelItem:
            text: 'Processing'
            BoxLayout:
                orientation: 'horizontal'
                BoxLayout:
                    orientation: 'vertical'
                    Label:
                        markup: True
                        text: '[size=12sp]Smoothing (Percent)[/size]'
                    BoxLayout:
                        orientation: 'horizontal'
                        CheckBox:
                            active: root.smoothing_enabled
                            on_active: root.smoothing_enabled = self.active
                        TextInput:
                            multiline: False
                            input_filter: 'float'
                            font_size: '11sp'
                            text: str(root.smoothing_factor)
                            on_focus: root.smoothing_factor = float(self.text)
                BoxLayout:
                    orientation: 'vertical'
                    Label:
                        markup: True
                        text: '[size=12sp]Scaling[/size]'
                    BoxLayout:
                        orientation: 'horizontal'
                        CheckBox:
                            active: root.scaling_enabled
                            on_active: root.scaling_enabled = self.active
                        BoxLayout:
                            orientation: 'horizontal'
                            Label:
                                markup: True
                                text: '[size=11sp]Min dB[/size]'
                            TextInput:
                                multiline: False
                                input_filter: 'float'
                                font_size: '11sp'
                                text: str(root.scaling_min_db)
                                on_focus: root.scaling_min_db = float(self.text)
                        BoxLayout:
                            orientation: 'horizontal'
                            Label:
                                markup: True
                                text: '[size=11sp]Max dB[/size]'
                            TextInput:
                                multiline: False
                                input_filter: 'float'
                                font_size: '11sp'
                                text: str(root.scaling_max_db)
                                on_focus: root.scaling_max_db = float(self.text)
        TabbedPanelItem:
            text: 'Device'
            BoxLayout:
                orientation: 'horizontal'
                BoolOption:
                    label_text: 'Remote Host'
                    value: root.is_remote
                    on_value: root.is_remote = self.value
                TextOption:
                    label_text: 'Host address'
                    value: root.remote_hostname
                    on_value: root.remote_hostname = self.value
                NumericOption:
                    label_text: 'Host Port'
                    value: root.remote_port
                    on_value: root.remote_port = self.value
        TabbedPanelItem:
            id: live_view
            text: 'Live View'
            BoxLayout:
                orientation: 'vertical'
                Label:
                    size_hint_y: .1
                    text: ''
                SpectrumGraphSimple:
                    id: live_spectrum_graph
                    size_hint_y: .9
    BoxLayout:
        orientation: 'vertical'
        size_hint_x: .2
        Button:
            id: start_btn
            text: 'Start'
            disabled: root.scanning
            on_release: root.on_scan_button_release()
        Button:
            id: stop_btn
            text: 'Stop'
            diabled: True
            on_release: root.on_stop_button_release()

<ScanGainDropDown>:
    on_select: self.scan_controls.gain = args[1]

<ScanGainDropDownBtn>:
    size_hint_y: None
    height: 44
    text: str(self.gain)
    on_release: self.parent.parent.select(self.gain)

<WindowTypeDropDown>:
    on_select: self.scan_controls.window_type = args[1]

<WindowTypeDropDownBtn>:
    size_hint_y: None
    height: 44
    on_release: self.parent.parent.select(self.text)

<AdvancedOptions>:
    orientation: 'horizontal'
    on_window_type: self.window_type_dropdown_trigger = None
    NumericOption:
        label_text: 'Sweeps per scan'
        prop_name: 'sweeps_per_scan'
    NumericOption:
        label_text: 'Samples per sweep'
        is_float: False
        prop_name: 'samples_per_sweep'
    NumericOption:
        label_text: 'Window Size'
        allownone: True
        prop_name: 'window_size'
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: 'Window Type'
        Button:
            text: root.window_type
            on_release: root.window_type_dropdown_trigger = self
    NumericOption:
        label_text: 'FFT Size'
        prop_name: 'fft_size'

<RtlPowerAdvancedOptions>:
    orientation: 'horizontal'
    on_window_type: self.window_type_dropdown_trigger = None
    NumericOption:
        label_text: 'Bin Size (mHz)'
        prop_name: 'rtl_bin_size'
        is_float: True
    NumericOption:
        label_text: 'Crop Percent'
        prop_name: 'rtl_crop'
    NumericOption:
        label_text: 'FIR Size'
        prop_name: 'rtl_fir_size'
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: 'Window Type'
        Button:
            text: root.window_type
            on_release: root.window_type_dropdown_trigger = self

<NumericOption>:
    orientation: 'vertical'
    Label:
        text: root.label_text
    TextInput:
        multiline: False
        input_filter: None if root.allownone else {True:'float', False:'int'}.get(root.is_float)
        text: str(root.value)
        on_focus:
            if not self.focus and root.allownone and not self.text.isdigit():\
            root.value = None
            elif not self.focus and root.is_float: root.value = float(self.text)
            elif not self.focus: root.value = int(self.text)

<TextOption>:
    orientation: 'vertical'
    Label:
        text: root.label_text
    TextInput:
        multiline: False
        text: root.value
        on_focus: if not self.focus: root.value = self.text

<BoolOption>:
    orientation: 'horizontal'
    Label:
        text: root.label_text
    CheckBox:
        active: root.value
        on_active: root.value = self.active
