<ActionButton>:
    on_release: app.on_action_button_release(self)
    
<RootWidget>:
    orientation: 'vertical'
    plot_container: plot_container
    scan_controls: scan_controls
    status_bar: status_bar
    ActionBar:
        pos_hint: {'top':1}
        size_hint_y: .1
        ActionView:
            use_separator: True
            ActionPrevious:
                text: ''
                split_str: ''
                title: 'Action Bar'
                with_previous: False
            ActionGroup:
                text: 'File'
                mode: 'spinner'
                size_hint_x: None
                width: 90
                ActionButton:
                    text: 'New'
                    action: 'file.new'
                ActionButton:
                    text: 'Open'
                    action: 'file.open'
                ActionButton:
                    text: 'Save'
                    action: 'file.save'
                ActionButton:
                    text: 'Save As'
                    action: 'file.save_as'
                ActionButton:
                    text: 'Quit'
                    action: 'file.quit'
            ActionGroup:
                text: 'Scan'
                mode: 'spinner'
                size_hint_x: None
                width: 90
                ActionButton:
                    text: 'Scan Settings'
                    action: 'scan.settings'
                ActionButton:
                    text: 'Perform Scan'
                    action: 'scan.scan'
                ActionButton:
                    text: 'Save Scan'
                    action: 'scan.save'
            ActionGroup:
                text: 'Plots'
                mode: 'spinner'
                size_hint_x: None
                width: 90
                ActionButton:
                    text: 'Import'
                    action: 'plots.import'
                ActionButton:
                    text: 'Export'
                    action: 'plots.export'
    PlotContainer:
        id: plot_container
        orientation: 'horizontal'
        tool_panel: tool_panel
        spectrum_graph: spectrum_graph
        SpectrumGraph:
            id: spectrum_graph
            scan_controls: scan_controls
            #pos_hint: {'x':0, 'y':0}
        PlotToolPanel:
            id: tool_panel
            size_hint_x: .2
    ScanControls:
        id: scan_controls
        size_hint_y: .15
    StatusBar:
        id: status_bar
        size_hint_y: .05
    
    
<ColorButton@Button>:
    on_press: print("pressed")
    
<PlotToolPanel>:
    cols: 1
    rows: 8
    row_default_height: self.height / self.rows
    row_force_default: True
    size_hint_x: .2
    canvas:
        Color:
            rgb: .8, .8, .8
        Line:
            rectangle: self.x+1, self.y+1,self.width-1, self.height-1
    
<PlotTools>:
    orientation: 'vertical'
    label_widget: label_widget
    switch_widget: switch_widget
    color_btn: color_btn
    root_widget: app.root
    canvas:
        Color:
            rgb: .8, .8, .8
        Line:
            rectangle: self.x+1, self.y+1,self.width-1, self.height-1
    Label:
        id: label_widget
        text: self.parent.plot.name
        size_hint_y: .5
    BoxLayout:
        orientation: 'horizontal'
        size_hint_y: .5
        CheckBox:
            id: selected_checkbox
            group: 'selected_plot'
            active: self.parent.parent.plot.selected
            on_active: self.parent.parent.plot.selected = self.active
        CheckBox:
            id: switch_widget
            active: self.parent.parent.plot.enabled
            on_active: self.parent.parent.plot.enabled = self.active
        ColorButton:
            id: color_btn
            on_release: self.parent.parent.on_color_btn_release()
            canvas.after:
                Color:
                    rgba: self.parent.parent.plot.color
                Rectangle:
                    size: self.size
                    pos: self.pos
        
<PlotColorPicker>:
    orientation: 'vertical'
    spacing: 2
    color_picker: color_picker
    ok_btn: ok_btn
    cancel_btn: cancel_btn
    ColorPicker:
        id: color_picker
        color: root.color
        on_color: root.color[:3] = self.color[:3]
    BoxLayout:
        orientation: 'vertical'
        size_hint_y: .2
        Label:
            text: 'Alpha'
        BoxLayout:
            orientation: 'horizontal'
            Label:
                text: '%05.3f' % (alpha_slider.value)
            Slider:
                id: alpha_slider
                min: 0.0
                max: 1.0
                value: root.color[3]
                on_value: root.color[3] = self.value
    BoxLayout:
        orientation: 'horizontal'
        size_hint_y: .1
        Button:
            id: ok_btn
            text: 'Ok'
            on_release: root.dispatch('on_select', root)
        Button:
            id: cancel_btn
            text: 'Cancel'
            on_release: root.dispatch('on_cancel', root)
            
<ScanRangeControls>:
    orientation: 'horizontal'
    
<ScanRangeTextInput>:
    multiline: False
    on_text_validate: self.validate_input()
    input_filter: 'float'
    
<ScanControls>:
    orientation: 'horizontal'
    scan_range_widget: scan_range
    gain_txt: gain_txt
    start_btn: start_btn
    stop_btn: stop_btn
    canvas:
        Color:
            rgb: .8, .8, .8
        Line:
            rectangle: self.x+1, self.y+1,self.width-1, self.height-1
    BoxLayout:
        orientation: 'vertical'
        canvas:
            Color:
                rgb: .8, .8, .8
            Line:
                rectangle: self.x+1, self.y+1,self.width-1, self.height-1
        Label:
            text: 'Scan Range'
        ScanRangeControls:
            id: scan_range
            scan_range_start_txt: scan_range_start
            scan_range_end_txt: scan_range_end
            ScanRangeTextInput:
                id: scan_range_start
                range_index: 0
            ScanRangeTextInput:
                id: scan_range_end
                range_index: 1
    BoxLayout:
        orientation: 'vertical'
        Label:
            text: 'Gain'
        TextInput:
            id: gain_txt
            text: str(root.gain)
            on_text: root.gain = float(self.text)
            input_filter: float
    Button:
        id: start_btn
        text: 'Start'
        disabled: root.scanning
        on_release: root.on_scan_button_release()
    Button:
        id: stop_btn
        text: 'Stop'
        diabled: True
        on_release: root.on_stop_button_release()

<StatusBar>
    orientation: 'horizontal'
    message_box: message_box
    progress_bar: progress_bar
    Label:
        id: message_box
        size_hint_x: .75
        text: self.parent.message_text
    ProgressBar:
        id: progress_bar
        size_hint_x: .25
        value_normalized: self.parent.progress
        
<SpectrumGraph>:
    #size_hint: [1., 1.]
    #pos_hint: {'x':0, 'y':0}
    tick_container: tick_container
    TickContainer:
        id: tick_container
        pos_hint: {'x':0, 'y':0}
        size_hint: [1., 1.]
        #size: root.size
        #pos: root.pos
    
<SpectrumPlot>:
    pos_hint: {'x':0, 'y':0}
    size_hint: [1., 1.]
    canvas:
        Color:
            rgba: self.color
        Line:
            points: self.points
        
<TickContainer>:
    #pos_hint: {'x':0, 'y':0}
    #size_hint: [.8, .8]
    
    
#<Tickline>:
#    size_hint: [1., 1.]
#    #pos: [0, 0] if self.parent is None else self.parent.pos
#    size: [200, 200] if self.parent is None else self.parent.size
    
<MessageDialog>:
    orientation: 'vertical'
    Label:
        id: lbl_widget
        multiline: True
        size_hint_y: .8
        text: self.parent.message
    Button:
        id: close_btn
        text: self.parent.close_text
        on_release: app.root.close_message()
